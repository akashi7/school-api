generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum ERole {
  ADMIN
  STUDENT
  PARENT
  SCHOOL
}

enum EPaymentMethod {
  AIRTEL
  MTN
}

model User {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now())
  deletedAt    DateTime?
  email        String?       @unique
  username     String?       @unique
  phone        String?       @unique
  regNo        String?       @unique
  schoolCode   String?       @unique
  names        String
  academicYear String?
  country      String?
  countryCode  String?
  password     String?
  refreshToken String?
  active       Boolean       @default(true)
  role         ERole         @default(STUDENT)
  schoolId     String?       @db.ObjectId
  school       User?         @relation(name: "SchoolStudents", fields: [schoolId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  students     User[]        @relation(name: "SchoolStudents")
  parentId     String?       @db.ObjectId
  parent       User?         @relation(name: "ParentChildren", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children     User[]        @relation(name: "ParentChildren")
  feesPaid     Transaction[] @relation(name: "ParentTransactions")
  feesReceived Transaction[] @relation(name: "SchoolTransactions")
}

model Transaction {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now())
  deletedAt     DateTime?
  referenceCode String
  paymentMethod EPaymentMethod
  payerId       String?        @db.ObjectId
  payer         User?          @relation("ParentTransactions", fields: [payerId], references: [id])
  payee         User?          @relation("SchoolTransactions", fields: [payeeId], references: [id])
  payeeId       String?        @db.ObjectId
  date          DateTime
  phoneNumber   String?
  amount        Float
  reason        String?
}
